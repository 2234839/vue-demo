{"version":3,"file":"vue.composition.api.d9b52cd0.js","sources":["../../src/components/promise-loading/lib/vue.composition.api.ts"],"sourcesContent":["/** â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ğŸ³â€ğŸŒˆ å®ç”¨åŠŸèƒ½ ğŸ³â€ğŸŒˆâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n *  åˆ©ç”¨ composition-api å®ç°çš„ä¸€äº›å®ç”¨åŠŸèƒ½\n ** â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•ğŸš§ å®ç”¨åŠŸèƒ½ ğŸš§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */\nimport {\n  customRef,\n  nextTick,\n  watch,\n  watchEffect,\n  WatchSource\n} from \"vue\";\n\nclass PromiseObj<T, Err = Error> {\n  pending = true;\n  fulfilled = false;\n  rejected = false;\n  data = {} as T;\n  error = {} as Err;\n  private p = Promise.resolve() as Promise<unknown>;\n  setP(p: Promise<unknown>) {\n    this.p = p;\n  }\n  equalP(p: Promise<unknown>) {\n    return this.p === p;\n  }\n}\n\ninterface usePromiseComputedOptions<T> {\n  /** å‡½æ•°å†…çš„ä¾èµ–å˜æ›´çš„æ—¶å€™å°±é‡æ–°è®¡ç®—ï¼Œåœ¨é‡Œé¢åŒ…å«è¯·æ±‚çš„æ—¶å€™æœ€å¥½æŒ‡å®šä¾èµ–ï¼Œå› ä¸ºè¯·æ±‚ä¼šæ”¹å˜ packet_tokenï¼Œè€Œå®ƒå±äºå“åº”å¼æ•°æ®ä¼šè¢«ä¾èµ–  */\n  deps?: WatchSource<any>;\n  getter: () => Promise<T>;\n  /** å¤„ç†æ•°æ®æ˜¯å¦è¦å’Œä¹‹å‰çš„æ•°æ®è¿›è¡Œåˆå¹¶ */\n  dataMergeFun?: (oldData: T, newData: T) => T;\n  /** data çš„é»˜è®¤å€¼ */\n  defaultData?: T;\n}\nexport function usePromiseComputed<T, Err = Error>({\n  deps,\n  getter,\n  dataMergeFun = (oldData, newData) => newData,\n  defaultData,\n}: usePromiseComputedOptions<T>){\n  const r = new PromiseObj<T, Err>();\n  if (defaultData !== undefined) {\n    r.data = defaultData;\n  }\n  return customRef<PromiseObj<T, Err>>((track, trigger) => {\n    if (!deps) {\n      watchEffect(() => update(getter()));\n    } else if (deps) {\n      watch(deps, () => update(getter()), { immediate: true });\n    }\n    function update(p: Promise<T>) {\n      r.setP(p);\n      r.pending = true;\n      r.fulfilled = false;\n      r.rejected = false;\n\n      // ç«‹å³è§¦å‘ä¼šå¯¼è‡´æ­»å¾ªç¯ï¼Œæ‰€ä»¥åŒ…è£¹ä¸€å±‚\n      nextTick(trigger);\n      p.then((res) => {\n        // é¿å… ã€Œæ±‚å€¼funã€ ç¬¬ä¸€æ¬¡æ‰§è¡Œäº§ç”Ÿçš„ promise æ¯” ç¬¬äºŒæ¬¡äº§ç”Ÿçš„åç»“æŸ å¯¼è‡´ æ•°æ®é”™è¯¯çš„é‡‡ç”¨äº†ç¬¬ä¸€æ¬¡çš„\n        if (r.equalP(p)) {\n          r.pending = false;\n          r.fulfilled = true;\n          r.data = dataMergeFun(r.data, res);\n        }\n      })\n        .catch((e) => {\n          if (r.equalP(p)) {\n            r.pending = false;\n            r.rejected = true;\n            r.error = e;\n          }\n        })\n        .finally(() => {\n          if (r.equalP(p)) {\n            trigger();\n          }\n        });\n    }\n\n    return {\n      get() {\n        track();\n        return r;\n      },\n      set(newValue) {\n        console.warn(\"ä¸å¯è®¾ç½®å€¼\");\n      },\n    };\n  });\n}\n\n/** é˜²æŠ–çš„ ref */\nexport function useDebouncedRef<T>(value: T, delay = 200) {\n  let timeout = 0;\n  return customRef<T>((track, trigger) => {\n    return {\n      get() {\n        track();\n        return value;\n      },\n      set(newValue) {\n        clearTimeout(timeout);\n        timeout = (setTimeout(() => {\n          value = newValue;\n          trigger();\n        }, delay) as unknown) as number;\n      },\n    };\n  });\n}"],"names":["[object Object]","Promise","resolve","p","this","deps","getter","dataMergeFun","oldData","newData","defaultData","r","PromiseObj","data","customRef","track","trigger","setP","pending","fulfilled","rejected","then","res","equalP","catch","e","error","finally","update","immediate","get","newValue","warn"],"mappings":"wDAWA,QAAAA,4BACY,kBACE,iBACD,YACJ,cACC,UACIC,QAAQC,UACpBF,KAAKG,QACEA,EAAIA,EAEXH,OAAOG,UACEC,KAAKD,IAAMA,eAa6BE,KACjDA,SACAC,eACAC,EAAe,EAACC,EAASC,IAAYA,eACrCC,UAEMC,EAAI,IAAIC,cACM,IAAhBF,MACAG,KAAOH,GAEJI,GAA8B,CAACC,EAAOC,gBAM3Bb,KACZc,KAAKd,KACLe,SAAU,IACVC,WAAY,IACZC,UAAW,IAGJJ,KACPK,MAAMC,IAEFX,EAAEY,OAAOpB,OACTe,SAAU,IACVC,WAAY,IACZN,KAAON,EAAaI,EAAEE,KAAMS,OAG/BE,OAAOC,IACFd,EAAEY,OAAOpB,OACTe,SAAU,IACVE,UAAW,IACXM,MAAQD,MAGbE,SAAQ,KACHhB,EAAEY,OAAOpB,kBA7BdE,EAEMA,KACHA,GAAM,IAAMuB,EAAOtB,MAAW,CAAEuB,WAAW,OAFrC,IAAMD,EAAOtB,OAkCpB,CACLwB,aAESnB,GAETX,IAAI+B,WACMC,KAAK"}